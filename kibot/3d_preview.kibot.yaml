# 3D preview exports for SweepyWay keyboard
# Generates STEP models and PNG renders from KiCad 3D viewer
#
# IMPORTANT: For 3D models to work, you must set BOTH environment variables:
#   - PATH_TO_SWEEPYWAY_COMPONENT_MODELS (used in PCB files)
#   - KICAD9_3DMODEL_DIR (used by KiCad 9)
#
# Both should point to the same directory: ./component_3d_models/
#
# GitHub Actions sets these automatically. For local testing:
#   PATH_TO_SWEEPYWAY_COMPONENT_MODELS=./component_3d_models \
#   KICAD9_3DMODEL_DIR=./component_3d_models \
#   kibot -c kibot/3d_preview.kibot.yaml

kibot:
  version: 1

# Import default outputs (gerbers, drill, images, etc.)
import:
  - ./default.kibot.yaml

# Preflight settings
preflight:
  fill_zones: true
  drc: false
  run_erc: false

# 3D export outputs
outputs:
  # 3D Model File Export (STEP format)
  - name: 3d_model_step
    comment: "3D model in STEP format"
    type: export_3d
    dir: filtered-output/pcbs/3d
    options:
      format: step
      output: '%f-3d.%x'
      origin: grid
      no_virtual: false
      download: true

  # 3D Model File Export (STL format)
  - name: 3d_model_stl
    comment: "3D model in STL format"
    type: export_3d
    dir: filtered-output/pcbs/3d
    options:
      format: stl
      output: '%f-3d.%x'
      origin: grid
      no_virtual: false
      download: true

  # 3D Rendered Images (top view)
  - name: 3d_render_top
    comment: "3D rendered top view"
    type: render_3d
    dir: filtered-output/pcbs/images
    options:
      view: top
      zoom: 0
      background1: '#66667F'
      background2: '#CCCCE5'
      board: '#332B16'
      output: '%f-3d-top.%x'
      download: true
      no_virtual: false

  # 3D Rendered Images (bottom view)
  - name: 3d_render_bottom
    comment: "3D rendered bottom view"
    type: render_3d
    dir: filtered-output/pcbs/images
    extends: 3d_render_top
    options:
      view: bottom

# Global filters to suppress warnings
global:
  filters:
    - number: 8
      regex: 'Unable to find KiCad configuration file'
    - number: 10
      regex: 'Unable to find KiCad user templates'
    - number: 10
      regex: 'Unable to find KiCad 3D models'
    - number: 58
      regex: 'KiCad project file not found|Missing KiCad main config file'
